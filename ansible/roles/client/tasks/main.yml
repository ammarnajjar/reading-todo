---
# tasks file for client

- name: Tear down existing services
  docker_compose:
    project_src: '{{ project_src }}'
    state: absent

- name: Create and start services
  docker_compose:
    project_src: '{{ project_src }}'
  register: output

- debug:
    var: output

- name: Run `docker-compose up` again
  docker_compose:
    project_src: '{{ project_src }}'
    build: no
  register: output

- debug:
    var: output

- name: assert output did not change
  assert:
    that:
      - 'not output.changed'

- name: Stop all services
  docker_compose:
    project_src: '{{ project_src }}'
    build: no
    stopped: yes
  register: output

- debug:
    var: output

- name: client container not running
  assert:
    that:
      - 'not client.{{ container_name }}.state.running'

- name: Restart services
  docker_compose:
    project_src: '{{ project_src }}'
    build: no
    restarted: yes
  register: output

- debug:
    var: output

- name: client container is running
  assert:
    that:
      - 'client.{{ container_name }}.state.running'
